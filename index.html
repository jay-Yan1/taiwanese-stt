<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-JJJTTHM12F"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
    
      gtag('config', 'G-JJJTTHM12F');
    </script>
<meta charset="UTF-8">
<title>台語語音輸入（台羅 + 漢字）</title>
<link rel="stylesheet" href="assets/css/style.css">
</head>

<body>
    <!-- =========================
     🧓 極簡模式 Simple Mode
     ========================= -->
    <main id="simpleMode" class="simple-wrap" role="main" aria-label="台語聽歌唱歌 極簡模式" style="display:none;">
      <h1 class="simple-title">🎵 台語聽歌・唱歌</h1>
      <p class="simple-sub">不用打字。按紅色講話，按綠色去 YouTube。</p>
    
      <button id="simpleTalkBtn" class="big-btn btn-talk" type="button">🔴 按這裡講話</button>
      <button id="simpleYoutubeBtn" class="big-btn btn-youtube" type="button">🟢 去 YouTube 找歌</button>
      <button id="simpleClearBtn" class="big-btn btn-clear" type="button">🟡 清掉，重來</button>
    
      <div id="simpleStatus" class="status" aria-live="polite">請按紅色按鈕講話</div>
    
      <section class="result" aria-label="辨識結果">
        <div class="label">你剛才講的是：</div>
        <div id="simpleResultText" class="text">（尚未輸入）</div>
        <div class="hint">提示：講「歌手 + 歌名」，例如「江蕙 酒後的心聲」</div>
      </section>
    
      <div class="footer">
        <span id="goAdvancedLink" class="link-advanced" role="button" tabindex="0">切換進階模式</span>
      </div>
    </main>
    
    <div class="container">
    <!-- =========================
     🧓 困難模式 hard Mode
     ========================= -->

    <h1>🎤 台語語音輸入測試與管理介面 </h1>
    <div class="subtitle">上方功能：複製、朗讀、管理常用字；下方按鈕：錄音與清除。</div>
      <button
      id="toggleExtraFeaturesBtn"
      title="顯示/隱藏非常用功能"
      >
      顯示狀態
    </button>
    <!-- 上方：其他功能/ 管理常用字 -->
    <div class="upper-controls">
        <div class="dropdown">
            <button id="manageBtn" class="btn-outline">⚙ 管理常用字 ▾</button>
            <div id="manageMenu" class="dropdown-menu">
                <button type="button" data-action="add">➕ 新增常用字</button>
                <button type="button" data-action="view">📖 查看常用字</button>
                <button type="button" data-action="delete">🗑 刪除常用字</button>
                <button type="button" data-action="exportJson">💾 匯出 JSON</button>
                <button type="button" data-action="importJson">📂 匯入 JSON</button>
                <button type="button" data-action="exportCsv">💾 匯出 CSV</button>
                <button type="button" data-action="importCsv">📂 匯入 CSV</button>
            </div>
        <div class="dropdown">
            <button id="otherBtn" class="btn-outline">✨ 其他功能 ▾</button>
            <div id="otherMenu" class="dropdown-menu">
            </div>
        </div>
    </div>
        <button id="apiKeyBtn" class="btn-outline" title="設定/查看 API 憑證">🔑 API 憑證</button>
</div>

<div id="status" class="status"></div>

<!-- ✅ 這裡開始是：左邊文字匡 + 右邊搜尋按鈕 -->
<div class="text-search-wrap">

    <!-- 📝 文字匡（佔 80%） -->
    <div class="output text-area">

        <div class="label" style="margin-top: 8px;">台語漢字：</div>
        <textarea class="hanji input-box" id="hanjiOutput" rows="3" placeholder="（台語漢字顯示/可手動輸入）"></textarea>

        <div class="label">台羅拼音（Tailo）：</div>
        <textarea class="tailo input-box" id="tailoOutput" rows="2" placeholder="（台羅顯示/可手動輸入）"></textarea>

        
    </div>
    <!--最愛區20%-->
    <div class="favorites-panel">
        <div class="fav-title">⭐ 我的最愛</div>
        <div id="favoritesBar" class="favorites-bar"></div>
        <div class="fav-hint">（到「✨其他功能 → ⭐管理我的最愛」設定）</div>
    </div>
  


</div>


    <!-- 下方：錄音／停止／清除 -->
    <div class="lower-controls" style="margin-top: 14px;">

        <button id="startBtn" class="btn-primary">▶ 開始錄音</button>
        <button id="stopBtn" class="btn-danger" disabled>■ 停止錄音</button>
        <button id="handwriteBtn" class="btn-secondary">✍️ 手寫輸入</button>
        <button id="clearBtn" class="btn-secondary">🧹 清除內容</button>
    
</div>
<div class="note">※ 常用字會儲存在此電腦瀏覽器的本機儲存空間（localStorage）。</div>
<!-- 🧓 進階模式底部：切換極簡模式（刻意小字，避免長輩誤觸） -->
<div style="margin-top:10px; display:flex; justify-content:center;">
  <span id="goSimpleLink"
        style="font-size:14px; color:#6b7280; text-decoration:underline; cursor:pointer; padding:6px 8px; border-radius:10px;"
        role="button" tabindex="0" aria-label="切換極簡模式">
    切換極簡模式
  </span>
</div>
    
</div>


<!-- 🔑 API 憑證視窗 -->
<div id="apiKeyModal" class="modal" style="display:none;">
  <div class="modal-content" style="max-width:520px;">
    <div style="display:flex; align-items:center; justify-content:space-between; gap:12px;">
      <h2 style="margin:0;">🔑 API 憑證</h2>
      <button id="apiKeyCloseBtn" class="btn-outline" style="padding:6px 10px;">✕</button>
    </div>

    <p style="margin:10px 0 6px; font-size:14px; opacity:.9;">
      只需輸入一次，會儲存在此瀏覽器（localStorage）。之後使用語音/影像服務會自動套用。
    </p>

    <div style="display:flex; flex-wrap:wrap; gap:8px; align-items:center; margin-top:8px;">
      <input id="apiKeyModalInput" type="password" autocomplete="off"
        placeholder="貼上 API Key（只需一次）"
        style="flex:1; min-width:240px; padding:10px 12px; border:1px solid #bbb; border-radius:12px;">
      <button id="saveApiKeyBtn" class="btn">儲存</button>
      <button id="clearApiKeyBtn" class="btn-outline">清除</button>
    </div>

    <div style="margin-top:10px; display:flex; align-items:center; gap:8px;">
      <span id="apiKeyStatus" style="font-size:13px; opacity:.85;">（未設定）</span>
      <span style="font-size:13px; opacity:.75;">（不會上傳到任何地方，僅在本機儲存）</span>
    </div>
  </div>
</div>


<!-- 📘 使用說明視窗 -->
<div id="helpModal" class="modal" style="display:none;">
  <div class="modal-content" style="max-width:720px; width:92%; text-align:left;">
    <div style="display:flex; align-items:center; justify-content:space-between; gap:12px;">
      <h2 style="margin:0;">📘 使用說明（第一次使用看這裡）</h2>
      <div style="display:flex; gap:8px; align-items:center;">
        <button id="helpEditBtn" class="btn" style="padding:6px 10px;">✏️ 編輯</button>
        <button id="helpResetBtn" class="btn-outline" style="padding:6px 10px;">重設</button>
        <button id="helpCloseBtn" class="btn-outline" style="padding:6px 10px;">✕</button>
      </div>
    </div>

    <div id="helpContent" style="margin-top:10px; font-size:14px; line-height:1.7; color:#111827;">
  <div id="helpIframeWrap" style="display:block;">
    <div style="display:flex; justify-content:space-between; align-items:center; gap:8px; flex-wrap:wrap; margin-bottom:8px;">
      <div id="helpIframeHint" style="font-size:13px; opacity:.8;">線上說明（Notion）</div>
      <div style="display:flex; gap:8px; align-items:center;">
        <button id="helpReloadIframeBtn" class="btn-outline" style="padding:6px 10px;">重新載入</button>
        <button id="helpUseLocalBtn" class="btn-outline" style="padding:6px 10px;">改用本機說明</button>
      </div>
    </div>
    <iframe id="helpIframe"
      src=""
      width="100%"
      height="600"
      frameborder="0"
      allowfullscreen
      loading="lazy"
      style="border:1px solid #e5e7eb; border-radius:12px; background:white;"
    ></iframe>
    <div id="helpIframeStatus" style="margin-top:6px; font-size:12px; opacity:.75;"></div>
  </div>

  <div id="helpFallback" style="display:none;">

      <ol style="margin:0; padding-left:18px;">
        <li><b>開始語音輸入：</b>按 <b>▶ 開始錄音</b>，說完後按 <b>■ 停止錄音</b>。辨識結果會填入「台語漢字 / 台羅」輸入框。</li>
        <li><b>設定 API 憑證：</b>若你要用到雲端辨識（例如語音/影像服務），請點上方的 <b>🔑 API 憑證</b>，貼上 Key 後按「儲存」。<b>只需輸入一次</b>，之後會自動沿用。</li>
        <li><b>手寫輸入（有 Top 候選）：</b>按 <b>✍️ 手寫輸入</b> → 在白色方框寫字 → 按「✔ 進行辨識」。
            下面會出現<b>前 5 個候選字</b>，點你要的字，再按「⬇ 套用到輸入框」。</li>
        <li><b>不想自動換行：</b>系統會把手寫辨識的字<b>直接接在游標後面</b>，不會幫你插入換行。
            （你仍然可以在輸入框內手動按 Enter 自己換行。）</li>
        <li><b>我的最愛：</b>到 <b>✨ 其他功能 → ⭐ 管理我的最愛</b> 勾選常用按鈕。
            已加入的功能會出現在右側「⭐ 我的最愛」區；沒加入的會留在「其他功能」選單。</li>
        <li><b>管理常用字：</b>點 <b>⚙ 管理常用字</b> 可新增/查看/刪除，並支援 JSON/CSV 匯入匯出（方便換電腦備份）。</li>
      </ol>

      <hr style="border:none; border-top:1px solid #e5e7eb; margin:12px 0;">
      <div><b>常見問題</b></div>
      <ul style="margin:6px 0 0; padding-left:18px;">
        <li>手寫辨識「一」很難？請把橫線寫長一點、粗一點，或改寫成「一個/第一」再選候選字。</li>
        <li>按辨識沒反應：請確認網路可用、瀏覽器允許彈窗/混合內容，或已設定 API Key（若你用到需要 Key 的服務）。</li>
      </ul>
    
  </div>
</div>
  </div>

<!-- ✏️ 編輯使用說明視窗 -->
<div id="manualEditModal" class="modal" style="display:none;">
  <div class="modal-content" style="max-width:760px; width:92%; text-align:left;">
    <div style="display:flex; align-items:center; justify-content:space-between; gap:12px;">
      <h2 style="margin:0;">✏️ 編輯使用說明</h2>
      <button id="manualEditCloseBtn" class="btn-outline" style="padding:6px 10px;">✕</button>
    </div>

    <p style="margin:10px 0 6px; font-size:14px; opacity:.9;">
      這份說明會儲存在此瀏覽器（localStorage），只要編輯一次，下次開啟仍會保留。支援一般文字與換行。
    </p>

    <textarea id="manualEditTextarea" rows="14"
      style="width:100%; box-sizing:border-box; padding:12px; border:1px solid #bbb; border-radius:12px; font-size:14px; line-height:1.6;"
      placeholder="在這裡輸入你的說明內容…（可換行）"></textarea>

    <div style="margin-top:10px; display:flex; gap:8px; flex-wrap:wrap; justify-content:flex-end;">
      <button id="manualEditSaveBtn" class="btn">儲存</button>
      <button id="manualEditCancelBtn" class="btn-outline">取消</button>
      <button id="manualEditResetBtn" class="btn-danger">重設為預設</button>
    </div>
  </div>
</div>

</div>

<!-- ✍️ 手寫輸入視窗 -->
<div id="handwriteModal" class="modal" style="display:none;">
    <div class="modal-content">
        <h2>✍️ 手寫輸入</h2>

        <canvas id="handCanvas" width="424" height="424"
            style="border:1px solid #aaa; background:#fff; touch-action:none; width:424px; height:424px;">
        </canvas>

        <div style="margin-top:10px;">
            <button id="hwClearBtn" class="btn-outline">↺ 清除</button>
            <button id="hwRecognizeBtn" class="btn-accent">✔ 進行辨識</button>
        </div>

        <div id="hwResult" style="margin-top:12px; font-size:20px; color:#333;">
            （尚無辨識結果）
        </div>

        <div id="hwCandList" style="margin-top:10px; display:flex; flex-wrap:wrap; gap:8px;"></div>

        <button id="hwApplyBtn" class="btn">⬇ 套用到輸入框（需手動按）</button>
        <button id="hwCloseBtn" class="btn-outline">關閉</button>
    </div>
</div>


    <!--輸入存放區-->
    <input type="file" id="importJsonInput" accept=".json,application/json" style="display:none">
    <input type="file" id="importCsvInput" accept=".csv,text/csv" style="display:none">
    <input type="file" id="bgImageInput" accept="image/*" style="display:none">

    <!-- =========================
     第一次進站：選模式（記住選擇）
     ========================= -->
<div id="modeGate" class="modal" style="display:none;">
  <div class="modal-content" style="max-width:560px; width:92%; text-align:center;">
    <h2 style="margin:0 0 10px; font-size:26px;">請選擇使用模式</h2>
    <div style="font-size:18px; color:#374151; line-height:1.5; margin-bottom:12px;">
      給長輩使用建議選「極簡模式」。
    </div>

    <button id="chooseSimpleBtn" type="button"
      style="width:100%; margin:10px 0; border:none; border-radius:16px; padding:16px 14px;
             font-size:24px; font-weight:800; cursor:pointer; background:#16a34a; color:#fff;">
      🧓 極簡模式（大按鈕、找歌最快）
    </button>

    <button id="chooseAdvancedBtn" type="button"
      style="width:100%; margin:10px 0 6px; border:none; border-radius:16px; padding:16px 14px;
             font-size:22px; font-weight:800; cursor:pointer; background:#2563eb; color:#fff;">
      🛠 進階模式（完整功能）
    </button>

    <label style="display:flex; align-items:center; justify-content:center; gap:8px; margin-top:10px; font-size:16px; color:#374151;">
      <input id="rememberModeChk" type="checkbox" checked />
      記住我的選擇（下次自動進入）
    </label>

    <div style="margin-top:10px; font-size:14px; color:#6b7280;">
      之後也可在頁面底部切換，或長按標題 3 秒切換。
    </div>
  </div>
</div>
<!-- 👪 家庭設定（給家人操作，避免長輩誤觸） -->
<div id="familyModal" class="modal" style="display:none;">
  <div class="modal-content" style="max-width:640px; width:92%; text-align:left;">
    <div style="display:flex; align-items:center; justify-content:space-between; gap:12px;">
      <h2 style="margin:0;">👪 家庭設定</h2>
      <button id="familyCloseBtn" class="btn-outline" style="padding:6px 10px;">✕</button>
    </div>

    <div style="margin-top:10px; font-size:14px; color:#374151; line-height:1.6;">
      這裡是給家人/照顧者設定的。建議設定完成後，平常給長輩用「極簡模式」。
    </div>

    <hr style="border:none; border-top:1px solid #e5e7eb; margin:12px 0;">

    <div style="display:flex; flex-direction:column; gap:10px;">
      <label style="display:flex; gap:10px; align-items:center; font-size:16px;">
        <input id="forceSimpleChk" type="checkbox">
        <span><b>永遠進入極簡模式</b>（最推薦給長輩）</span>
      </label>

      <div style="font-size:15px; color:#374151;">
        <b>預設進入方式：</b>
        <div style="margin-top:6px; display:flex; flex-wrap:wrap; gap:10px;">
          <label style="display:flex; gap:8px; align-items:center;">
            <input type="radio" name="defaultModeRadio" value="ask">
            第一次詢問（選一次後記住）
          </label>
          <label style="display:flex; gap:8px; align-items:center;">
            <input type="radio" name="defaultModeRadio" value="simple">
            預設極簡
          </label>
          <label style="display:flex; gap:8px; align-items:center;">
            <input type="radio" name="defaultModeRadio" value="advanced">
            預設進階
          </label>
        </div>
      </div>

      <div style="display:flex; flex-wrap:wrap; gap:10px; margin-top:6px;">
        <button id="btnGoSimpleNow" class="btn" type="button">🧓 立刻切到極簡模式</button>
        <button id="btnGoAdvancedNow" class="btn-outline" type="button">🛠 立刻切到進階模式</button>
      </div>

      <div style="display:flex; flex-wrap:wrap; gap:10px; margin-top:6px;">
        <button id="btnResetModeRemember" class="btn-danger" type="button">♻️ 重設「記住的模式」</button>
        <button id="btnClearForceSimple" class="btn-outline" type="button">取消「永遠極簡」</button>
      </div>

      <div id="familyStatus" style="margin-top:6px; font-size:14px; color:#374151;"></div>
    </div>
  </div>
</div>

<script type="module" src="assets/js/app.js"></script>

</body>
</html>

